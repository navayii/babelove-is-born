function deferCommentsContent(){window.jQuery?domReadyCommentsContent():setTimeout(function(){deferCommentsContent()},100)}function domReadyCommentsContent(){function n(){jQuery(".mention").length>0?t():(clearTimeout(commentLoadedTimer),commentLoadedTimer=setTimeout(function(){n()},300))}function t(){jQuery(".accordianAnchor.plus").click();jQuery(window).scrollTop()==0&&jQuery("html,body").animate({scrollTop:jQuery(".mention").offset().top},1e3)}if(isApproved=jQuery("#HiddenIsContentApproved").val(),mentionarraydata=[],Type=jQuery("#hddType").val(),ContentId=jQuery("#hddContentId").val(),CurrentUser=jQuery("#hddCurrentUser").val(),CurrentRole=jQuery("#hddCurrentRole").val(),jQuery("#HiddenCommentPageNumber").val("1"),CurrentUserPhoto=jQuery("#hddCurrentUserPhoto").val(),ContentUserId=jQuery("#hddContentUserId").val(),LoginCheckReturnUrl=jQuery("#hiddenLoginCheckUrl").val(),isApproved=="false")return!1;Comments=function(){return rootClass="."+Type+" ",{GetComments:function(n){var t=jQuery("#HiddenCommentPageNumber").val(),i=jQuery(rootClass+"#RootComments");jQuery.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/WebServices/Comments.asmx/GetComments",data:"{'id':'"+ContentId+"','type':'"+Type+"','pageNumber':'"+t+"', 'pageSize':'"+pageSize+"', 'parentId':"+n+"}",async:!1,beforeSend:function(){jQuery(rootClass+"#mainLoader").show()},success:function(n){ProcessComments(n.d,Type);wrapComments();bindCachedComment()}})},LikeComment:function(n){var r=VerifyUser(),t,i;if(!r)return window.location.href=LoginCheckReturnUrl,!1;jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=like_comment&id="+n+"&type="+Type,type:"POST",async:!1,beforeSend:function(){jQuery(rootClass+"#ajaxLoader_"+n).show()},success:function(i){t=i;jQuery(rootClass+"#ajaxLoader_"+n).hide()},Error:ShowError});t=="1"?(i=jQuery(rootClass+"#Likes_"+n).text(),jQuery(rootClass+"#Likes_"+n).text(parseFloat(i)+1)):t=="2"&&jQuery(rootClass+"#Likes_"+n).css("color","#f60")},DeleteComment:function(n,t){var e=VerifyUser(),u,f,i;if(!e)return window.location.href=LoginCheckReturnUrl,!1;if(!confirm("Are you sure you want to delete this comment ?"))return!1;if(jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=delte_comment&id="+n+"&type="+Type,type:"POST",async:!1,success:function(n){u=n},Error:ShowError}),u=="1"){if(f=jQuery(rootClass+"#Replies_"+n).text(),jQuery(rootClass+"#comment_"+n).remove(),t==0)ManageAlternateColor(),ManagePaging("d",f),GetParentCommentsCount()==0&&Comments.GetComments(0);else{var o=jQuery(rootClass+"#Replies_"+t).text(),r=jQuery(rootClass+"#TotalComments"),s=jQuery(rootClass+"#CommentCount");jQuery(rootClass+"#Replies_"+t).text(parseFloat(o)-1);i=parseFloat(r.data("total-count"))-1;i===0?r.text("0"):r.text(i);r.data("total-count",i);s.text(parseFloat(GetParentCommentsCount())+parseFloat(GetChildCommentsCount()));jQuery("#spanComments").text(i)}parseInt(jQuery(rootClass+"#TotalComments").data("total-count"))===0&&jQuery(rootClass+"#TotalComments").text("0")}},PostComment:function(n,t){var i=null,r,u;if(jQuery("textarea.mention").mentionsInput("val",function(n){i=n}),i=FormatText(i),i=GetCommentData(i,"textarea.mention"),i=i.charAt(0).toUpperCase()+i.slice(1),t.keyCode==13){var f=jQuery(rootClass+"#RootComments"),e=jQuery("#HiddenTotalComments"),o=jQuery(rootClass+"#CommentCount");if(jQuery("<p>"+unescape(i)+"<\/p>").clone().find("a").remove().end().text().trim().replace(/\s+/g," ").length<commentsMinLength)return setTimeout(function(){jQuery(".comment-hint").length>0&&jQuery(".comment-hint").remove();var n=document.createElement("span");n.setAttribute("style","z-index:1;position: absolute;right: 0px;top: 56px;background:#fff;color: red;padding: 2px 5px;border: 1px solid #e8e8e8;border-left: 4px solid red;box-sizing: border-box;padding-left: 13px;");n.innerHTML="Comment can't be less than "+commentsMinLength+" characters.";jQuery(n).insertAfter(jQuery("textarea.mention"));setTimeout(function(){jQuery(n).fadeOut(500,function(){jQuery(n).remove()})},4e3)},50),t.preventDefault(),!1;if(i!=""){if(r=VerifyUser(),!r)return u={commentId:n,Comment:i},localStorage.setItem(Type+"_"+ContentId,JSON.stringify(u)),window.location.href=LoginCheckReturnUrl,!1;jQuery.ajax({url:"/WebServices/Comments.asmx/InsertComment",data:"{'content_id':'"+ContentId+"','type':'"+Type+"','parent_id':'"+n+"', 'description':"+JSON.stringify(i)+"}",type:"POST",contentType:"application/json; charset=utf-8",async:!1,beforeSend:function(){jQuery(rootClass+"#PostLoader").show();var t={commentId:n,Comment:i};localStorage.setItem(Type+"_"+ContentId,JSON.stringify(t))},success:function(r){localStorage.removeItem(Type+"_"+ContentId);var u=r.d[0],e=[],o=null;jQuery("textarea.mention").mentionsInput("getMentions",function(n){jQuery.each(n,function(n,t){e.push(t.id)})});jQuery("textarea.mention").mentionsInput("reset",function(){});f.prepend(BuildComment(u));jQuery("#comment_"+u.CommentId).hide().slideDown(500,function(){jQuery(this).attr("style","")});jQuery("#ctl00_RootPostComment .image img").length>0&&jQuery("#ctl00_RootPostComment img").attr("src")!=u.PhotoUrl&&jQuery("#ctl00_RootPostComment img").attr("src",u.PhotoUrl).attr("title",u.FullName).attr("alt",u.FullName);ManageAlternateColor();jQuery(rootClass+"#InputCommentText_"+n).val("").trigger("autosize.resize");parseFloat(GetParentCommentsCount())>parseFloat(pageSize)&&jQuery("#RootComments > div").last().remove();ManagePaging("i",0);SendMail(i,"0",u.ParentUserId,u.CommentId);e.length>0&&(o=e.join(","),SendNotification(i,o));jQuery(rootClass+"#PostLoader").hide();PreventDefault(t)},Error:ShowError})}else PreventDefault(t)}},ShowReplyBox:function(n){var i=jQuery(rootClass+"#CommentReplies_"+n),t;jQuery(rootClass+"#CommentReplies_"+n+" #ReplyContainer_"+n).length?jQuery(rootClass+"#CommentReplies_"+n+" #ReplyContainer_"+n+":visible").length>0?(jQuery(".esc-msg").remove(),jQuery(rootClass+"#CommentReplies_"+n+" #ReplyContainer_"+n).hide()):jQuery(rootClass+"#CommentReplies_"+n+" #ReplyContainer_"+n).show():(t=buildPostReplyBox(n,CurrentUserPhoto),i.append(t),jQuery(rootClass+"textarea#ReplyComment_"+n).elastic(),GetValueAtTheRate(rootClass+"textarea#ReplyComment_"+n),jQuery(rootClass+"#ReplyComment_"+n).focus(),jQuery(".esc-msg").remove(),removePrevComment(),PreviousCommentId="#ReplyContainer_"+n);jQuery(rootClass+"#CommentReplies_"+n).show()},ShowReplies:function(n,t){var i=jQuery(rootClass+"#CommentReplies_"+n),r=jQuery(rootClass+"#CommentCount");jQuery(rootClass+"#Replies_"+n).text()!="0"&&jQuery.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/WebServices/Comments.asmx/GetComments",data:"{'id':'"+ContentId+"','type': '"+Type+"','pageNumber':'1', 'pageSize':'50', 'parentId':"+n+"}",beforeSend:function(){jQuery(rootClass+"#ajaxLoader_"+n).show()},success:function(u){var e=u.d,f;i.html("");f=e[0];jQuery.each(f,function(n){f[n].CommentId;i.prepend(BulildCommentReply(f[n]))});jQuery(rootClass+"#ajaxLoader_"+n).hide();jQuery(t).remove();jQuery("#CommentReplies_"+n).show();r.text(parseFloat(GetParentCommentsCount())+parseFloat(GetChildCommentsCount()))}})},ToggleReplies:function(n){jQuery(rootClass+"#CommentReplies_"+n).html().length&&(jQuery(rootClass+"#CommentReplies_"+n+" .commentDescription").length>0||jQuery(rootClass+"#ReplyContainer_"+n).is(":visible"))&&jQuery(rootClass+"#CommentReplies_"+n).toggle()},PostCommentReply:function(n,t){var i=null,f,e;if(jQuery(rootClass+"#ReplyComment_"+n).mentionsInput("val",function(n){i=n}),i=FormatText(i),i=GetCommentData(i,rootClass+"#ReplyComment_"+n),i=i.charAt(0).toUpperCase()+i.slice(1),t.keyCode==13){var r=jQuery(rootClass+"#ReplyContainer_"+n),u=jQuery(rootClass+"#TotalComments"),o=jQuery(rootClass+"#CommentCount");if(jQuery("<p>"+unescape(i)+"<\/p>").clone().find("a").remove().end().text().trim().replace(/\s+/g," ").length<commentsMinLength)return setTimeout(function(){jQuery(jQuery(".reply-comment-hint").length>0);jQuery(".reply-comment-hint pull-right").remove();var t=document.createElement("span");t.setAttribute("style","z-index:1;position: absolute;right: 0px;bottom: -20px;background:#fff;color: red;padding: 2px 5px;border: 1px solid #e8e8e8;border-left: 4px solid red;box-sizing: border-box;padding-left: 13px;z-index:1");t.innerHTML="Comment can't be less than "+commentsMinLength+" characters.";jQuery(t).insertAfter(jQuery(rootClass+"#ReplyComment_"+n).parent().parent());setTimeout(function(){jQuery(t).fadeOut(500,function(){jQuery(t).remove()})},4e3)},50),t.preventDefault(),!1;if(jQuery(rootClass+"#ReplyComment_"+n).mentionsInput("reset",function(){}),i!=""){if(f=VerifyUser(),!f)return e={commentId:n,Comment:i},localStorage.setItem(Type+"_"+ContentId,JSON.stringify(e)),window.location.href=LoginCheckReturnUrl,!1;jQuery.ajax({url:"/WebServices/Comments.asmx/InsertComment",data:"{'content_id':'"+ContentId+"','type':'"+Type+"','parent_id':'"+n+"', 'description':'"+i+"'}",type:"POST",contentType:"application/json; charset=utf-8",async:!1,beforeSend:function(){jQuery(rootClass+"#PostLoader_"+n).show();var t={commentId:n,Comment:i};localStorage.setItem(Type+"_"+ContentId,JSON.stringify(t))},success:function(f){var e,h,s;localStorage.removeItem(Type+"_"+ContentId);e=f.d[0];r.before(BulildCommentReply(e));r.find(".image img").length>0&&r.find(".image img").attr("src")!=e.PhotoUrl&&r.find(".image img").attr("src",e.PhotoUrl).attr("title",e.FullName).attr("alt",e.FullName);jQuery(rootClass+"#ReplyComment_"+n).val("").trigger("autosize.resize");h=jQuery(rootClass+"#Replies_"+n).text();jQuery(rootClass+"#Replies_"+n).text(parseFloat(h)+1);s=parseFloat(u.data("total-count"))+1;s===0?u.text("0"):u.text(s);u.data("total-count",s);o.text(parseFloat(GetParentCommentsCount())+parseFloat(GetChildCommentsCount()));jQuery("#spanComments").text(s);SendMail(i,"1",e.ParentUserId,e.CommentId);jQuery(rootClass+"#PostLoader_"+n).hide();PreventDefault(t)},Error:ShowError})}else PreventDefault(t)}},ShowEditView:function(n){var o=jQuery(rootClass+"#comment_"+n+" .commentDescription div:eq(0) .icon-edit-content2"),f=jQuery(rootClass+"#comment_"+n+" .commentDescription div:eq(1)"),h='<textarea id="CommentToEdit_'+n+'" onkeyup="Comments.RemovePreviousComment('+n+",this,event,'edit');\" onkeypress=\"Comments.EditComment("+n+',event);" class="form-control" spellcheck="true"  onfocus="this.value = this.value;" style="margin-bottom:4px;"  ><\/textarea>                <img id="ajaxLoaderEdit_'+n+'" src="/Images/csharp/ajax-loader-small.gif" class="hide" alt="Loading..." />',t,i;o.hide().next().hide();o.prev().hide();f.after(h);var u=f.html(),r=u.match(/<a[^>]+>([^<]+)<\/a>/g),s=null,e=null;if(r)for(t=0;t<=r.length-1;t++)s=jQuery(r[t]).attr("href"),e=r[t].match(/<a[^>]+>([^<]+)<\/a>/)[1],mentionarraydata.push(e+"/^g*~o0#g*^/"+s),u=u.replace(r[t],e);jQuery(rootClass+"#CommentToEdit_"+n).focus();jQuery(rootClass+"#CommentToEdit_"+n).val(u);f.hide();jQuery(rootClass+"textarea#CommentToEdit_"+n).elastic();removePrevComment();PreviousCommentId=n;jQuery(".esc-msg").remove();i=document.createElement("span");i.innerHTML="Press Esc key to cancel";i.setAttribute("class","esc-msg hidden-md-down");i.setAttribute("style","color:#ff0000;margin-left: 70px;display:block;margin-bottom:-12px;");jQuery("#comment_"+n).before(i)},EditComment:function(n,t){var u=jQuery(rootClass+"#CommentToEdit_"+n),i=jQuery(rootClass+"#CommentToEdit_"+n).val().trim(),r,f,e;if(i=FormatText(i),i=GetEditData(i),t.keyCode==13){if(r=jQuery(rootClass+"#comment_"+n+" .commentDescription div:eq(1)"),u.val(u.val().replace("\n","")),jQuery("<p>"+unescape(i)+"<\/p>").clone().find("a").remove().end().text().trim().replace(/\s+/g," ").length<commentsMinLength)return setTimeout(function(){jQuery(".comment-hint").length>0&&jQuery(".comment-hint").remove();var t=document.createElement("span");t.setAttribute("style","z-index:1;position: absolute;right: 0px;top: 56px;background:#fff;color: red;padding: 2px 5px;border: 1px solid #e8e8e8;border-left: 4px solid red;box-sizing: border-box;padding-left: 13px;z-index:1");t.innerHTML="Comment can't be less than "+commentsMinLength+" characters.";jQuery(t).insertAfter(jQuery(rootClass+"#CommentToEdit_"+n));setTimeout(function(){jQuery(t).fadeOut(500,function(){jQuery(t).remove()})},4e3)},50),t.preventDefault(),!1;if(i==r.text()||i=="")RemoveEditView(n),jQuery(".esc-msg").remove(),removePrevComment(),PreviousCommentId="",PreventDefault(t);else{if(f=VerifyUser(),!f)return window.location.href=LoginCheckReturnUrl,!1;jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=edit_comment&id="+n+"&type="+Type,type:"POST",async:!1,data:{description:i},beforeSend:function(){jQuery(rootClass+"#ajaxLoaderEdit_"+n).show()},success:function(n){e=n;PreventDefault(t);mentionarraydata.length=0;jQuery(".esc-msg").remove();removePrevComment();PreviousCommentId=""},Error:ShowError});e=="1"&&(r.html(decodeURIComponent(i)),RemoveEditView(n))}}},UpdateFollowStatus:function(n){var t;t=jQuery(n).is(":checked")?!0:!1;jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=comment_follow_status&id="+ContentId+"&type="+Type+"&status="+t,type:"POST",async:!1,beforeSend:function(){jQuery(rootClass+"#PostLoader").show()},success:function(n){n=="1"&&jQuery(rootClass+"#PostLoader").hide()},Error:ShowError})},ViewPreviousComments:function(){var n=jQuery("#HiddenCommentPageNumber").val(),t=jQuery("#HiddenTotalComments").val();parseFloat(t)>parseFloat(n)*pageSize?jQuery("#HiddenCommentPageNumber").val(parseFloat(n)+1):(jQuery(rootClass+"#RootComments").text(""),jQuery("#HiddenCommentPageNumber").val("1"));Comments.GetComments(0)},ShowEditorOptions:function(n){jQuery(n).find(".comment-parent:first").show()},HideEditorOptions:function(n){jQuery(n).find(".comment-parent:first").hide()},ShowEditorOptionsReply:function(n,t){jQuery(n).find(".comment-child:first").show();jQuery(n).parent().siblings().find(".comment-parent").hide();t.stopPropagation()},HideEditorOptionsReply:function(n,t){jQuery(n).find(".comment-child:first").hide();t.stopPropagation()},ReportComment:function(n,t,i,r,u){return confirm("Are you sure you want to report this comment?")?(jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=report_comment&CommentId="+n+"&Comment="+i+"&CommentedBy="+t+"&ContenType="+Type+"&CommentedByUrl="+r+"&CommentedByFullName="+u,type:"POST",success:function(n){n=="Login"?window.location="/login?returnurl="+window.location.href:n=="1"?alert("Successfully Reported."):n=="2"?alert("Already Reported."):console.log("Error")},error:function(n){console.log(n)}}),!1):!1},RemovePreviousComment:function(n,t,i,r){if(jQuery(".esc-msg").remove(),i.keyCode===27){PreviousCommentId="";jQuery(t).val("");jQuery(".mentions-autocomplete-list").hide();jQuery("div.mentions>div").html("");switch(r){case"edit":RemoveEditView(n);break;case"reply":jQuery("#ReplyContainer_"+n).remove()}}else if(jQuery(t).val().trim().length>0){var u=document.createElement("span");u.innerHTML="Press Esc key to cancel";u.setAttribute("class","esc-msg hidden-md-down");u.setAttribute("style","color:#ff0000;margin-left: 70px;display:block;margin-bottom:-12px;");switch(r){case"reply":jQuery("#ReplyContainer_"+n).before(u);jQuery("#InputCommentText_0").val("");break;case"post":jQuery(".comment-body").prepend(u);removePrevComment();PreviousCommentId="";break;case"edit":jQuery("#comment_"+n).before(u);jQuery("#InputCommentText_0").val("")}}}}}();var i=jQuery("#HiddenProcessType").val();i=="common"?(Comments.GetComments(0),GetValueAtTheRate("textarea.mention"),jQuery("#CommentIcon,#CommentIcon2").click(function(){jQuery("#InputCommentText_0").focus()})):GetArticleCommnets();jQuery.ajaxSetup({cache:!1});jQuery("#hddAllowPost").val()==undefined&&(AllowPost=jQuery("#HiddenIsAllowPost").val());AllowPost!=undefined&&AllowPost.toLowerCase()=="false"&&jQuery("#RootPostComment").remove();jQuery(document).on("click",function(n){var t=n.target.className;t==="mention"?jQuery(".mentions-autocomplete-list").has("ul").show():jQuery(".mentions-autocomplete-list").hide()});jQuery('a[href="#ReadAndPostComment"]').on("click",function(){jQuery(".accordianAnchor.plus").length>0&&jQuery(".accordianAnchor.plus").click()});window.location.hash.indexOf("ReadAndPostComment")>-1&&n()}function PreventDefault(n){n.preventDefault?n.preventDefault():n.returnValue=!1}function GetParentCommentsCount(){return jQuery(rootClass+"#RootComments > div.media").size()}function GetChildCommentsCount(){var n=jQuery(rootClass+"#RootComments > div.pulsecomment div.commentcontent div div.ReplyComment").size(),t=jQuery(rootClass+"#RootComments > div.pulsecomment div.commentcontent textarea").size();return n>0?n-t:0}function ManageAlternateColor(){jQuery(rootClass+"#RootComments > div").removeClass("BackgroundWhite");jQuery(rootClass+"#RootComments > div:odd").addClass("BackgroundWhite")}function SendMail(n,t,i,r){var u=jQuery("#hddContentUserEmail").val();jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=send_mail&type="+Type,data:{description:unescape(n),content_title:jQuery("#hddContentTitle").val(),content_user_id:ContentUserId,is_child_comment:t,content_id:ContentId,parent_user_id:i,request_url:window.location.protocol+"//"+window.location.hostname+window.location.pathname,content_url:window.location.pathname,content_user_email:u,comment_id:r},type:"POST",async:!1,success:function(){}})}function SendNotification(n,t){var i=window.location.href;jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=send_notification&type="+Type,data:{description:unescape(n),mailtosend:t,currenturl:i},type:"POST",async:!1,success:function(){}})}function VerifyUser(){var n;return LoginCheckReturnUrl=jQuery("#hiddenLoginCheckUrl").val(),jQuery.ajax({url:"/Handlers/CommentsHandler.ashx?method=current_user",type:"GET",async:!1,success:function(t){n=jQuery.parseJSON(t)[0].user_name}}),n==null||n==""?!1:!0}function ManagePaging(n,t){var r=jQuery(rootClass+"#TotalComments"),e=jQuery(rootClass+"#CommentCount"),u=jQuery.trim(jQuery("#HiddenTotalComments").val()),i=r.data("total-count"),f;switch(n){case"i":u=parseFloat(u)+1;i=i===""||i==="0"?1:parseFloat(i)+1;i===0?r.text(""):r.text(i);r.data("total-count",i);jQuery(rootClass+"#Paging").show();break;case"d":parseFloat(u)<=0?(r.text("0"),e.text(""),jQuery(rootClass+"#Paging").hide()):(i=parseFloat(i)-(1+parseFloat(t)),r.text(i),r.data("total-count",i),u=parseFloat(u)-1)}f=parseFloat(GetParentCommentsCount());e.text(f+parseFloat(GetChildCommentsCount()));jQuery("#HiddenTotalComments").val(u);jQuery("#HiddenCommentPageNumber").val(parseInt((f-1)/pageSize)+1);ManageViewMoreVisibility();jQuery("#spanComments").text(i)}function ManageViewMoreVisibility(){var n=jQuery("#ViewPreviousComments");parseFloat(jQuery("#HiddenTotalComments").val())>parseFloat(GetParentCommentsCount())?n.show():n.hide()}function RemoveEditView(n){var r=jQuery(rootClass+"#comment_"+n+" .commentDescription div:eq(1)"),t=jQuery(rootClass+"#comment_"+n+" .commentDescription div:eq(0) .icon-edit-content2"),i=jQuery(rootClass+"#CommentToEdit_"+n),u=jQuery(rootClass+"#ajaxLoaderEdit_"+n);t.show().next().show();t.prev().show();i.val("");i.remove();u.remove();r.show()}function ShowError(){alert("There is some error processing your request")}function GetValueAtTheRate(n){jQuery(n).mentionsInput({minChars:1,onDataRequest:function(n,t,i){jQuery.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/WebServices/CSharpSearch.asmx/GetAllFriendsFollowers",data:"{'name':'"+t+"','user_id':'"+CurrentUser+"','content_id':'"+ContentId+"','type':'"+Type+"'}",async:!1,success:function(n){for(var u,r=n.d,f=[],e=null,o=null,s=null,h=null,t=0;t<=r.length-1;t++)e=r[t].Id,o=r[t].Name,s=r[t].PhotoUrl,h=r[t].AuthorUrl,u=new JasonObj(e,o,s,h),f.push(u);i.call(this,f)}})}})}function GetCommentData(n,t){var i=null,r=null,u=null;return jQuery(t).mentionsInput("getMentions",function(t){jQuery.each(t,function(t,f){i="@["+f.value+"]("+f.type+":"+f.id+")";r=FormatText(i);u='<a target="_blank" class="LinkNormalBlue" href="'+decodeURIComponent(f.type)+'">'+f.value+"<\/a>";n=n.replace(r,u)})}),n}function FormatText(n){return escape(jQuery.trim(n).replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace("/","&#47;").replace('"',"&quot;").replace("\n","").replace("\\","&#92;"))}function GetEditData(n){var t,r,i;if(n=unescape(n),mentionarraydata){for(t=null,r=null,i=0;i<=mentionarraydata.length-1;i++)t=mentionarraydata[i].split("/^g*~o0#g*^/")[0],r=mentionarraydata[i].split("/^g*~o0#g*^/")[1],n.indexOf(t)!==-1&&(n=n.replace(t,"<a target=_blank class=LinkNormalGray href="+r+">"+t+"<\/a>"));mentionarraydata.length=0}return escape(n)}function GetArticleCommnets(){var u=jQuery("#hddArticleID").val(),f=jQuery("#HiddenAuthorId").val(),t="",n,i,r;jQuery("#HiddenFiledContentTitle").length>0&&(t=jQuery("#HiddenFiledContentTitle").val().replace("'","\\'"));n=jQuery("#HiddenContentType").val();i=jQuery("#hddRawUrl").val();IsAllowPost=jQuery("#HiddenIsAllowPost").val();r=1;jQuery.ajax({type:"POST",url:"/WebServices/CommonServices.asmx/GetArticleCommentsNew",data:"{'ContentId':'"+u+"','ContentUserId':'"+f+"','ContentTitle':'"+t+"','Type':'"+n+"','articleRawUrl':'"+i+"','pageSize':'"+pageSize+"','pageNumber':'"+r+"','isAllowPost':'"+IsAllowPost+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){t.d.html.length>0&&(jQuery(".commentsContainer").append(t.d.html),VariableInitialization(),ProcessComments(t.d.comments,n),wrapComments(),bindCachedComment())},complete:function(){GetValueAtTheRate("textarea.mention");jQuery("#CommentIcon,#CommentIcon2").click(function(){jQuery("#InputCommentText_0").focus()})}})}function bindCachedComment(){var n=localStorage.getItem(Type+"_"+ContentId);n!==null&&(n=JSON.parse(localStorage.getItem(Type+"_"+ContentId)),n.commentId==0?jQuery("#InputCommentText_0").val(unescape(n.Comment)):(Comments.ShowReplyBox(n.commentId),jQuery("#ReplyComment_"+n.commentId).val(unescape(n.Comment))))}function ProcessComments(n,t){var u=n,r=u[0],f,e,s;rootClass="."+t+" ";var h=jQuery(rootClass+"#RootComments"),o=jQuery("#HiddenCommentPageNumber").val(),i=0;r[0]==undefined?(jQuery(rootClass+"#mainLoader").hide(),jQuery(rootClass+"#Paging").hide()):(jQuery.each(r,function(n){h.append(BuildComment(r[n]));o==1&&n==0&&(jQuery("#HiddenTotalComments").val(r[n].TotalComments),f=u[2][n]==null||u[2][n]==undefined?r[n].TotalComments:parseFloat(r[n].TotalComments)+parseFloat(u[2][n].TotalComments),f===0?jQuery(rootClass+"#TotalComments").text(""):jQuery(rootClass+"#TotalComments").text(f),jQuery(rootClass+"#TotalComments").data("total-count",f),jQuery("#spanComments").text(f));i=parseFloat(i)+1;ManageAlternateColor()}),e=u[1],jQuery.each(e,function(n){s=jQuery(rootClass+"#CommentReplies_"+e[n].ParentId);s.prepend(BulildCommentReply(e[n]));i=parseFloat(i)+1}),i!=0&&parseFloat(o)>=1?parseFloat(o)==1?jQuery(rootClass+"#CommentCount").text(i):jQuery(rootClass+"#CommentCount").text(parseFloat(jQuery(rootClass+"#CommentCount").text())+i):jQuery(rootClass+"#Paging").hide(),ManageViewMoreVisibility(),jQuery(rootClass+"#mainLoader").hide());jQuery("#HiddenIsAllowPost").length>0&&jQuery("#HiddenIsAllowPost").val()=="false"&&jQuery("#RootPostComment").hide()}function VariableInitialization(){Type=jQuery("#hddType").val();rootClass=Type;ContentId=jQuery("#hddContentId").val();CurrentUserPhoto=jQuery("#hddCurrentUserPhoto").val();ContentUserId=jQuery("#hddContentUserId").val();AllowPost=jQuery("#hddAllowPost").val();LoginCheckReturnUrl=jQuery("#hiddenFieldReturnUrl").val();CurrentUser=jQuery("#hddCurrentUser").val();CurrentRole=jQuery("#hddCurrentRole").val()}function wrapComments(){_eventsBoundToComments||(jQuery("#divViewPreviousComments").hide(),jQuery(".accordianDetail").hide(),jQuery(".accordianAnchor").click(function(){jQuery(this).hasClass("plus")?(jQuery(this).removeClass("plus").addClass("minus"),jQuery(".accordianDetail").slideDown("slow"),ManageViewMoreVisibility(),jQuery("#divViewPreviousComments").show(),jQuery(".mentions+#InputCommentText_0").focus()):(jQuery(this).removeClass("minus").addClass("plus"),jQuery(".accordianDetail").slideUp("slow"),jQuery("#divViewPreviousComments").hide())}),jQuery("#commentsBox").click(function(){jQuery(".accordianAnchor").click()}),_eventsBoundToComments=!0,jQuery(this).removeClass("plus").addClass("minus"),jQuery(".accordianDetail").slideDown("slow"),ManageViewMoreVisibility(),jQuery("#divViewPreviousComments").show())}function BuildComment(n){var i=n.AuthorUrl,r=unescape(n.Description),t,u,f;return t='<div class="media" id="comment_'+n.CommentId+'" onmouseover="Comments.ShowEditorOptions(this,event);" onmouseout="Comments.HideEditorOptions(this,event);" >',t+='<div class="media-left"><a href="'+i+'"><img class="user-image-56" alt="'+n.FullName+'" title="'+n.FullName+'" src="'+n.PhotoUrl+'" /><\/a><\/div>',t+='<div class="media-body"><div class="commentDescription">',t+='<div class="comment-action-button comment-parent">',CurrentUser==n.UserId||CurrentRole=="E"||CurrentRole=="A"?((CurrentUser==n.UserId||CurrentRole=="A")&&(t+='<a onclick="Comments.DeleteComment('+n.CommentId+","+n.ParentId+')" title="Delete" href="javascript:void(0)"  class="d-icon icon-delete-content2"><\/a>'),t+='<a onclick="Comments.ShowEditView('+n.CommentId+')" href="javascript:void(0)" title="Edit" class="d-icon icon-edit-content2"><\/a>',CurrentUser!=n.UserId&&(t+='<a class="icon-20 d-icon icon-flag" href="javascript:void(0)" onclick="return Comments.ReportComment('+n.CommentId+",'"+n.UserId+"','"+escape(r)+"','"+i+"','"+n.FullName+'\');" title="Report this comment"><\/a> ')):t+='<a class="d-icon icon-flag" href="javascript:void(0)" onclick="return Comments.ReportComment('+n.CommentId+",'"+n.UserId+"','"+escape(r)+"','"+i+"','"+n.FullName+'\');" title="Report this comment"><\/a> ',t+='<\/div><div data-comment class="commentDescription">'+r+"<\/div>",t+='<div class="comment-info clearfix">                    <span class="comment-time">                    <i class="d-icon icon-clock-small"><\/i>'+n.CreatedDate+'<\/span><a href="'+n.AuthorUrl+'" alt="'+n.FullName+'">'+n.FullName+"<\/a><\/div>",u=n.AuthorRank,f="Rank",n.IsInternal&&(u=n.UserType=="A"?"Admin":n.UserType=="E"?"Editor":"Tech Writer",f=n.UserType=="A"?"Admin":n.UserType=="E"?"Editor":"Tech Writer"),t+='<div class="comment-info clearfix">',t+='<span class="rpv-wrapper">                    <span title="'+f+'"><i class="d-icon icon-author-r"><\/i>'+u+'<\/span>                    <span title="Reputation"><i class="d-icon icon-author-p"><\/i>'+n.AuthorPoints+'<\/span>                    <span title="Total Views"><i class="d-icon icon-author-v"><\/i>'+n.AuthorReadCount+"<\/span><\/span>",t+='<ul class="list-inline comment-reply-wrapper">                    <li title="Likes">                        <img alt="Loading..." id="ajaxLoader_'+n.CommentId+'" src="/Images/csharp/ajax-loader-small.gif" style="margin:4px 0px 0px 5px;" class="hide" />                        <a href="javascript:void(0)" onclick="Comments.LikeComment('+n.CommentId+')">                        <i class="v-middle icon-20 d-icon icon-like-small"><\/i><span id="Likes_'+n.CommentId+'" class="text-grey-600">'+n.Likes+'<\/span> <\/a><\/li>                    <li title="Replies"><a href="javascript:void(0)" onclick="Comments.ToggleReplies('+n.CommentId+')" >                    <i class="v-middle icon-20 d-icon icon-reply-small"><\/i>                    <span id="Replies_'+n.CommentId+'" class="text-grey-600">'+n.Replies+"<\/span> <\/a><\/li>",AllowPost.toLowerCase()=="true"&&(t+='<li class="text-grey-600">                            <a class="text-grey-600" href="javascript:void(0)" onclick="Comments.ShowReplyBox('+n.CommentId+')" title="Post Reply">                            <i class="v-middle icon-20 d-icon icon-reply-all-small"><\/i>Reply<\/a><\/li>'),parseFloat(n.Replies)>3&&(t+='<li class="reply-collapse">                            <a href="javascript:void(0)" onclick="Comments.ShowReplies('+n.CommentId+', this)" title="Show All">                            <i class="text-icon">'+n.Replies+"<\/i><\/a><\/li>"),t+="<\/ul><\/div>",t+='<div class="media comment-replies" id="CommentReplies_'+n.CommentId+'"><\/div>',t+"<\/div>"}function BulildCommentReply(n){var i=n.AuthorUrl,r=unescape(n.Description),t='<div class="media" id="comment_'+n.CommentId+'" onmouseover="Comments.ShowEditorOptionsReply(this,event);" onmouseout="Comments.HideEditorOptionsReply(this,event);" >',u,f;return t+='<div class="media-left"><a href="'+i+'"><img class="user-image-56" alt="'+n.FullName+'" title="'+n.FullName+'" src="'+n.PhotoUrl+'" /><\/a><\/div>',t+='<div class="media-body"><div class="commentDescription">',t+='<div class="comment-action-button comment-child">',CurrentUser==n.UserId||CurrentRole=="E"||CurrentRole=="A"?((CurrentUser==n.UserId||CurrentRole=="A")&&(t+='<a onclick="Comments.DeleteComment('+n.CommentId+","+n.ParentId+')" title="Delete" href="javascript:void(0)"  class="d-icon icon-delete-content2"><\/a>'),t+='<a onclick="Comments.ShowEditView('+n.CommentId+')" title="Edit" href="javascript:void(0)" class="d-icon icon-edit-content2"><\/a>',CurrentUser!=n.UserId&&(t+='<a class="d-icon icon-flag" href="javascript:void(0)" onclick="return Comments.ReportComment('+n.CommentId+",'"+n.UserId+"','"+escape(r)+"','"+i+"','"+n.FullName+'\');" title="Report this comment"><\/a> ')):t+='<a href="javascript:void(0)" class="d-icon icon-flag" onclick="return Comments.ReportComment('+n.CommentId+",'"+n.UserId+"','"+escape(r)+"','"+i+"','"+n.FullName+'\');" title="Report this comment"><\/a> ',t+='<\/div><div data-comment class="commentDescription">'+r+"<\/div>",t+='<div class="comment-info clearfix">                    <span class="comment-time">                    <i class="d-icon icon-clock-small"><\/i>'+n.CreatedDate+'<\/span><a href="'+n.AuthorUrl+'" alt="'+n.FullName+'">'+n.FullName+"<\/a><\/div>",u=n.AuthorRank,f="Rank",n.IsInternal&&(u=n.UserType=="A"?"Admin":n.UserType=="E"?"Editor":"Tech Writer",f=n.UserType=="A"?"Admin":n.UserType=="E"?"Editor":"Tech Writer"),t+='<div class="comment-info clearfix">',t+='<span class="rpv-wrapper">                    <span title="'+f+'"><i class="d-icon icon-author-r"><\/i>'+u+'<\/span>                    <span title="Reputation"><i class="d-icon icon-author-p"><\/i>'+n.AuthorPoints+'<\/span>                    <span title="Total Views"><i class="d-icon icon-author-v"><\/i>'+n.AuthorReadCount+"<\/span><\/span>  ",t+='<ul class="list-inline comment-reply-wrapper">                    <li title="Likes">                    <img alt="Loading..." id="ajaxLoader_'+n.CommentId+'" src="/Images/csharp/ajax-loader-small.gif" class="hide" />                    <a href="javascript:void(0)" onclick="Comments.LikeComment('+n.CommentId+')">                        <i class="v-middle icon-20 d-icon icon-like-small"><\/i><span id="Likes_'+n.CommentId+'" class="text-grey-600">'+n.Likes+"<\/span> <\/a>                    <\/li><\/ul>",t+="<\/div>",t+"<\/div>"}function buildPostReplyBox(n,t){return'<div class="media" id="ReplyContainer_'+n+'">                            <div class="media-left">                            <img src="'+t+'" alt="Author Photo" class="user-image-56"><\/div>                            <div class="media-body reply-comment-box">                            <textarea id="ReplyComment_'+n+'" onkeyup="Comments.RemovePreviousComment('+n+",this,event,'reply');\" onkeypress=\"Comments.PostCommentReply("+n+',event);" class="form-control" spellcheck="true" placeholder="Type your comment here and press Enter Key (Minimum '+commentsMinLength+' characters)"><\/textarea>                            <img id="PostLoader_'+n+'" src="/images/csharp/ajax-loader-small.gif" alt="Loading..." class="hide">                            <\/div><\/div>'}function removePrevComment(){PreviousCommentId!=""&&(typeof PreviousCommentId!="number"?jQuery(PreviousCommentId).remove():RemoveEditView(PreviousCommentId))}var JasonObj;document.addEventListener("DOMContentLoaded",function(){deferCommentsContent()});var Comments="",_eventsBoundToComments=!1,commentsMinLength=10,mentionarraydata="",Type="",ContentId="",CurrentUser="",CurrentRole="",CurrentUserPhoto="",ContentUserId="",AllowPost="true",LoginCheckReturnUrl="",pageSize=10,rootClass="",isApproved=!0,commentLoadedTimer=0,PreviousCommentId="";JasonObj=function(n,t,i,r){this.id=n;this.name=t;this.avatar=i;this.type=r}